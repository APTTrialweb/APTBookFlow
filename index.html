<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>BookFlow</title>
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    input, button { padding: 8px; margin: 5px; }
    .hidden { display: none; }
    .success { color: green; }
    .error { color: red; }
  </style>
</head>
<body>
  <h2>Coordinator Login</h2>
  <div id="loginBox">
    <input id="coordID" placeholder="ID"><br>
    <input id="coordPass" type="password" placeholder="Password"><br>
    <button onclick="login()">Login</button>
    <p id="loginMsg"></p>
  </div>

  <div id="scanBox" class="hidden">
    <p>Welcome, <span id="coordName"></span></p>
    <input id="batchID" placeholder="Batch ID"><br>
    <button onclick="scan()">Scan</button>
    <p id="scanMsg"></p>
    <div id="updateBox" class="hidden">
      <input id="remaining" placeholder="Remaining stock" type="number" min="0"><br>
      <button onclick="updateRemaining()">Update Remaining</button>
      <p id="updateMsg"></p>
    </div>
    <button onclick="logout()">Logout</button>
  </div>

  <script>
    const API_URL = "https://script.google.com/macros/s/AKfycbyz721ZaVDIAHYdDOLb9dyPpBYR0y8Y1V3wwQOILhzZQmbgfiNiYJLrc3M5AFyW5dvnMA/exec"; // replace with your GAS /exec URL
    let loggedInID = "", lastBatch = "";

    async function apiPost(payload) {
      const res = await fetch(API_URL, {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(payload)
      });
      return res.json();
    }

    async function login() {
      const id = document.getElementById("coordID").value.trim();
      const password = document.getElementById("coordPass").value.trim();
      const res = await apiPost({ action: "login", id, password });
      if (res.success) {
        loggedInID = id;
        document.getElementById("coordName").innerText = res.name;
        document.getElementById("loginBox").classList.add("hidden");
        document.getElementById("scanBox").classList.remove("hidden");
      } else {
        document.getElementById("loginMsg").innerText = res.message;
        document.getElementById("loginMsg").className = "error";
      }
    }

    async function scan() {
      const batchID = document.getElementById("batchID").value.trim();
      if (!batchID) return;
      lastBatch = batchID;
      const res = await apiPost({ action: "scan", batchID, coordinatorID: loggedInID });
      if (res.success) {
        document.getElementById("scanMsg").innerText = "Stock remaining: " + res.remaining;
        document.getElementById("updateBox").classList.remove("hidden");
        document.getElementById("remaining").value = res.remaining;
      } else {
        document.getElementById("scanMsg").innerText = res.message;
      }
    }

    async function updateRemaining() {
      const remaining = document.getElementById("remaining").value.trim();
      const res = await apiPost({ action: "updateRemaining", batchID: lastBatch, remaining, coordinatorID: loggedInID });
      document.getElementById("updateMsg").innerText = res.message;
      document.getElementById("updateMsg").className = res.success ? "success" : "error";
    }

    function logout() {
      loggedInID = "";
      lastBatch = "";
      document.getElementById("loginBox").classList.remove("hidden");
      document.getElementById("scanBox").classList.add("hidden");
    }
  </script>
</body>
</html>
